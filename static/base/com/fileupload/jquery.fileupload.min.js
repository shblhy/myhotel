;(function($){"use strict";if(typeof define==="function"&&define.amd)define(["jquery","jquery.ui.widget"],$);else $(window.jQuery)}(function($){"use strict";$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))"+"|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)"+"|(w(eb)?OSBrowser)|(webOS)"+"|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$("<input type=\"file\">").prop("disabled"));$.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);$.support.xhrFormDataFileUpload=!!window.FormData;$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:$(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(_,A){_=this.messages[_]||_.toString();if(A)$.each(A,function(A,$){_=_.replace("{"+A+"}",$)});return _},formData:function($){return $.serializeArray()},add:function(_,A){if(_.isDefaultPrevented())return false;if(A.autoUpload||(A.autoUpload!==false&&$(this).fileupload("option","autoUpload")))A.process().done(function(){A.submit()})},processData:false,contentType:false,cache:false},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){var $=this.slice||this.webkitSlice||this.mozSlice;return $.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=((Date.now)?Date.now():(new Date()).getTime());this.loaded=0;this.bitrate=0;this.getBitrate=function(B,$,A){var _=B-this.timestamp;if(!this.bitrate||!A||_>A){this.bitrate=($-this.loaded)*(1000/_)*8;this.loaded=$;this.timestamp=B}return this.bitrate}},_isXHRUpload:function(_){return!_.forceIframeTransport&&((!_.multipart&&$.support.xhrFileUpload)||$.support.xhrFormDataFileUpload)},_getFormData:function(A){var _;if(typeof A.formData==="function")return A.formData(A.form);if($.isArray(A.formData))return A.formData;if($.type(A.formData)==="object"){_=[];$.each(A.formData,function($,A){_.push({name:$,value:A})});return _}return[]},_getTotal:function(A){var _=0;$.each(A,function($,A){_+=A.size||1});return _},_initProgressObject:function(A){var _={loaded:0,total:0,bitrate:0};if(A._progress)$.extend(A._progress,_);else A._progress=_},_initResponseObject:function(_){var $;if(_._response){for($ in _._response)if(_._response.hasOwnProperty($))delete _._response[$]}else _._response={}},_onProgress:function(A,C){if(A.lengthComputable){var B=((Date.now)?Date.now():(new Date()).getTime()),_;if(C._time&&C.progressInterval&&(B-C._time<C.progressInterval)&&A.loaded!==A.total)return;C._time=B;_=Math.floor(A.loaded/A.total*(C.chunkSize||C._progress.total))+(C.uploadedBytes||0);this._progress.loaded+=(_-C._progress.loaded);this._progress.bitrate=this._bitrateTimer.getBitrate(B,this._progress.loaded,C.bitrateInterval);C._progress.loaded=C.loaded=_;C._progress.bitrate=C.bitrate=C._bitrateTimer.getBitrate(B,_,C.bitrateInterval);this._trigger("progress",$.Event("progress",{delegatedEvent:A}),C);this._trigger("progressall",$.Event("progressall",{delegatedEvent:A}),this._progress)}},_initProgressListener:function(B){var _=this,A=B.xhr?B.xhr():$.ajaxSettings.xhr();if(A.upload){$(A.upload).bind("progress",function(A){var $=A.originalEvent;A.lengthComputable=$.lengthComputable;A.loaded=$.loaded;A.total=$.total;_._onProgress(A,B)});B.xhr=function(){return A}}},_isInstanceOf:function(_,$){return Object.prototype.toString.call($)==="[object "+_+"]"},_initXHRData:function(E){var _=this,A,C=E.files[0],B=E.multipart||!$.support.xhrFileUpload,D=E.paramName[0];E.headers=$.extend({},E.headers);if(E.contentRange)E.headers["Content-Range"]=E.contentRange;if(!B||E.blob||!this._isInstanceOf("File",C))E.headers["Content-Disposition"]="attachment; filename=\""+encodeURI(C.name)+"\"";if(!B){E.contentType=C.type;E.data=E.blob||C}else if($.support.xhrFormDataFileUpload){if(E.postMessage){A=this._getFormData(E);if(E.blob)A.push({name:D,value:E.blob});else $.each(E.files,function($,_){A.push({name:E.paramName[$]||D,value:_})})}else{if(_._isInstanceOf("FormData",E.formData))A=E.formData;else{A=new FormData();$.each(this._getFormData(E),function(_,$){A.append($.name,$.value)})}if(E.blob)A.append(D,E.blob,C.name);else $.each(E.files,function($,B){if(_._isInstanceOf("File",B)||_._isInstanceOf("Blob",B))A.append(E.paramName[$]||D,B,B.uploadName||B.name)})}E.data=A}E.blob=null},_initIframeSettings:function(A){var _=$("<a></a>").prop("href",A.url).prop("host");A.dataType="iframe "+(A.dataType||"");A.formData=this._getFormData(A);if(A.redirect&&_&&_!==location.host)A.formData.push({name:A.redirectParamName||"redirect",value:A.redirect})},_initDataSettings:function($){if(this._isXHRUpload($)){if(!this._chunkedUpload($,true)){if(!$.data)this._initXHRData($);this._initProgressListener($)}if($.postMessage)$.dataType="postmessage "+($.dataType||"")}else this._initIframeSettings($)},_getParamName:function(B){var _=$(B.fileInput),A=B.paramName;if(!A){A=[];_.each(function(){var _=$(this),B=_.prop("name")||"files[]",C=(_.prop("files")||[1]).length;while(C){A.push(B);C-=1}});if(!A.length)A=[_.prop("name")||"files[]"]}else if(!$.isArray(A))A=[A];return A},_initFormSettings:function(_){if(!_.form||!_.form.length){_.form=$(_.fileInput.prop("form"));if(!_.form.length)_.form=$(this.options.fileInput.prop("form"))}_.paramName=this._getParamName(_);if(!_.url)_.url=_.form.prop("action")||location.href;_.type=(_.type||($.type(_.form.prop("method"))==="string"&&_.form.prop("method"))||"").toUpperCase();if(_.type!=="POST"&&_.type!=="PUT"&&_.type!=="PATCH")_.type="POST";if(!_.formAcceptCharset)_.formAcceptCharset=_.form.attr("accept-charset")},_getAJAXSettings:function(_){var A=$.extend({},this.options,_);this._initFormSettings(A);this._initDataSettings(A);return A},_getDeferredState:function($){if($.state)return $.state();if($.isResolved())return"resolved";if($.isRejected())return"rejected";return"pending"},_enhancePromise:function($){$.success=$.done;$.error=$.fail;$.complete=$.always;return $},_getXHRPromise:function(A,C,B){var _=$.Deferred(),D=_.promise();C=C||this.options.context||D;if(A===true)_.resolveWith(C,B);else if(A===false)_.rejectWith(C,B);D.abort=_.promise;return this._enhancePromise(D)},_addConvenienceMethods:function(B,C){var _=this,A=function(A){return $.Deferred().resolveWith(_,A).promise()};C.process=function(B,D){if(B||D)C._processQueue=this._processQueue=(this._processQueue||A([this])).pipe(function(){if(C.errorThrown)return $.Deferred().rejectWith(_,[C]).promise();return A(arguments)}).pipe(B,D);return this._processQueue||A([this])};C.submit=function(){if(this.state()!=="pending")C.jqXHR=this.jqXHR=(_._trigger("submit",$.Event("submit",{delegatedEvent:B}),this)!==false)&&_._onSend(B,this);return this.jqXHR||_._getXHRPromise()};C.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";return _._getXHRPromise()};C.state=function(){if(this.jqXHR)return _._getDeferredState(this.jqXHR);if(this._processQueue)return _._getDeferredState(this._processQueue)};C.processing=function(){return!this.jqXHR&&this._processQueue&&_._getDeferredState(this._processQueue)==="pending"};C.progress=function(){return this._progress};C.response=function(){return this._response}},_getUploadedBytes:function($){var _=$.getResponseHeader("Range"),A=_&&_.split("-"),B=A&&A.length>1&&parseInt(A[1],10);return B&&B+1},_chunkedUpload:function(K,E){K.uploadedBytes=K.uploadedBytes||0;var A=this,D=K.files[0],G=D.size,F=K.uploadedBytes,C=K.maxChunkSize||G,I=this._blobSlice,_=$.Deferred(),H=_.promise(),B,J;if(!(this._isXHRUpload(K)&&I&&(F||C<G))||K.data)return false;if(E)return true;if(F>=G){D.error=K.i18n("uploadedBytes");return this._getXHRPromise(false,K.context,[null,"error",D.error])}J=function(){var E=$.extend({},K),H=E._progress.loaded;E.blob=I.call(D,F,F+C,D.type);E.chunkSize=E.blob.size;E.contentRange="bytes "+F+"-"+(F+E.chunkSize-1)+"/"+G;A._initXHRData(E);A._initProgressListener(E);B=((A._trigger("chunksend",null,E)!==false&&$.ajax(E))||A._getXHRPromise(false,E.context)).done(function(C,B,D){F=A._getUploadedBytes(D)||(F+E.chunkSize);if(H+E.chunkSize-E._progress.loaded)A._onProgress($.Event("progress",{lengthComputable:true,loaded:F-E.uploadedBytes,total:F-E.uploadedBytes}),E);K.uploadedBytes=E.uploadedBytes=F;E.result=C;E.textStatus=B;E.jqXHR=D;A._trigger("chunkdone",null,E);A._trigger("chunkalways",null,E);if(F<G)J();else _.resolveWith(E.context,[C,B,D])}).fail(function(B,$,C){E.jqXHR=B;E.textStatus=$;E.errorThrown=C;A._trigger("chunkfail",null,E);A._trigger("chunkalways",null,E);_.rejectWith(E.context,[B,$,C])})};this._enhancePromise(H);H.abort=function(){return B.abort()};J();return H},_beforeSend:function($,_){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer();this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(_);this._initProgressObject(_);_._progress.loaded=_.loaded=_.uploadedBytes||0;_._progress.total=_.total=this._getTotal(_.files)||1;_._progress.bitrate=_.bitrate=0;this._active+=1;this._progress.loaded+=_.loaded;this._progress.total+=_.total},_onDone:function(C,B,D,E){var A=E._progress.total,_=E._response;if(E._progress.loaded<A)this._onProgress($.Event("progress",{lengthComputable:true,loaded:A,total:A}),E);_.result=E.result=C;_.textStatus=E.textStatus=B;_.jqXHR=E.jqXHR=D;this._trigger("done",null,E)},_onFail:function(A,_,B,C){var $=C._response;if(C.recalculateProgress){this._progress.loaded-=C._progress.loaded;this._progress.total-=C._progress.total}$.jqXHR=C.jqXHR=A;$.textStatus=C.textStatus=_;$.errorThrown=C.errorThrown=B;this._trigger("fail",null,C)},_onAlways:function(_,$,A,B){this._trigger("always",null,B)},_onSend:function(C,E){if(!E.submit)this._addConvenienceMethods(C,E);var _=this,A,D,F,G,H=_._getAJAXSettings(E),B=function(){_._sending+=1;H._bitrateTimer=new _._BitrateTimer();A=A||(((D||_._trigger("send",$.Event("send",{delegatedEvent:C}),H)===false)&&_._getXHRPromise(false,H.context,D))||_._chunkedUpload(H)||$.ajax(H)).done(function(A,$,B){_._onDone(A,$,B,H)}).fail(function(A,$,B){_._onFail(A,$,B,H)}).always(function(A,$,B){_._onAlways(A,$,B,H);_._sending-=1;_._active-=1;if(H.limitConcurrentUploads&&H.limitConcurrentUploads>_._sending){var C=_._slots.shift();while(C){if(_._getDeferredState(C)==="pending"){C.resolve();break}C=_._slots.shift()}}if(_._active===0)_._trigger("stop")});return A};this._beforeSend(C,H);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){F=$.Deferred();this._slots.push(F);G=F.pipe(B)}else{this._sequence=this._sequence.pipe(B,B);G=this._sequence}G.abort=function(){D=[undefined,"abort","abort"];if(!A){if(F)F.rejectWith(H.context,D);return B()}return A.abort()};return this._enhancePromise(G)}return B()},_onAdd:function(C,E){var B=this,A=true,J=$.extend({},this.options,E),_=J.limitMultiFileUploads,H=this._getParamName(J),D,G,F,I;if(!(J.singleFileUploads||_)||!this._isXHRUpload(J)){F=[E.files];D=[H]}else if(!J.singleFileUploads&&_){F=[];D=[];for(I=0;I<E.files.length;I+=_){F.push(E.files.slice(I,I+_));G=H.slice(I,I+_);if(!G.length)G=H;D.push(G)}}else D=H;E.originalFiles=E.files;$.each(F||E.files,function(H,G){var _=$.extend({},E);_.files=F?G:[G];_.paramName=D[H];B._initResponseObject(_);B._initProgressObject(_);B._addConvenienceMethods(C,_);A=B._trigger("add",$.Event("add",{delegatedEvent:C}),_);return A});return A},_replaceFileInput:function(A){var _=A.clone(true);$("<form></form>").append(_)[0].reset();A.after(_).detach();$.cleanData(A.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(B,$){if($===A[0])return _[0];return $});if(A[0]===this.element[0])this.element=_},_handleFileTreeEntry:function(C,D){var A=this,_=$.Deferred(),E=function($){if($&&!$.entry)$.entry=C;_.resolve([$])},B;D=D||"";if(C.isFile){if(C._file){C._file.relativePath=D;_.resolve(C._file)}else C.file(function($){$.relativePath=D;_.resolve($)},E)}else if(C.isDirectory){B=C.createReader();B.readEntries(function($){A._handleFileTreeEntries($,D+C.name+"/").done(function($){_.resolve($)}).fail(E)},E)}else _.resolve([]);return _.promise()},_handleFileTreeEntries:function(B,A){var _=this;return $.when.apply($,$.map(B,function($){return _._handleFileTreeEntry($,A)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(_){_=_||{};var A=_.items;if(A&&A.length&&(A[0].webkitGetAsEntry||A[0].getAsEntry))return this._handleFileTreeEntries($.map(A,function(_){var $;if(_.webkitGetAsEntry){$=_.webkitGetAsEntry();if($)$._file=_.getAsFile();return $}return _.getAsEntry()}));return $.Deferred().resolve($.makeArray(_.files)).promise()},_getSingleFileInputFiles:function(A){A=$(A);var C=A.prop("webkitEntries")||A.prop("entries"),_,B;if(C&&C.length)return this._handleFileTreeEntries(C);_=$.makeArray(A.prop("files"));if(!_.length){B=A.prop("value");if(!B)return $.Deferred().resolve([]).promise();_=[{name:B.replace(/^.*\\/,"")}]}else if(_[0].name===undefined&&_[0].fileName)$.each(_,function($,_){_.name=_.fileName;_.size=_.fileSize});return $.Deferred().resolve(_).promise()},_getFileInputFiles:function(_){if(!(_ instanceof $)||_.length===1)return this._getSingleFileInputFiles(_);return $.when.apply($,$.map(_,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(A){var _=this,B={fileInput:$(A.target),form:$(A.target.form)};this._getFileInputFiles(B.fileInput).always(function(C){B.files=C;if(_.options.replaceFileInput)_._replaceFileInput(B.fileInput);if(_._trigger("change",$.Event("change",{delegatedEvent:A}),B)!==false)_._onAdd(A,B)})},_onPaste:function(_){var A=_.originalEvent&&_.originalEvent.clipboardData&&_.originalEvent.clipboardData.items,B={files:[]};if(A&&A.length){$.each(A,function($,A){var _=A.getAsFile&&A.getAsFile();if(_)B.files.push(_)});if(this._trigger("paste",$.Event("paste",{delegatedEvent:_}),B)!==false)this._onAdd(_,B)}},_onDrop:function(A){A.dataTransfer=A.originalEvent&&A.originalEvent.dataTransfer;var _=this,B=A.dataTransfer,C={};if(B&&B.files&&B.files.length){A.preventDefault();this._getDroppedFiles(B).always(function(B){C.files=B;if(_._trigger("drop",$.Event("drop",{delegatedEvent:A}),C)!==false)_._onAdd(A,C)})}},_onDragOver:function(_){_.dataTransfer=_.originalEvent&&_.originalEvent.dataTransfer;var A=_.dataTransfer;if(A&&$.inArray("Files",A.types)!==-1&&this._trigger("dragover",$.Event("dragover",{delegatedEvent:_}))!==false){_.preventDefault();A.dropEffect="copy"}},_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop});this._on(this.options.pasteZone,{paste:this._onPaste})}if($.support.fileInput)this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(B,_){var A=$.inArray(B,this._specialOptions)!==-1;if(A)this._destroyEventHandlers();this._super(B,_);if(A){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var _=this.options;if(_.fileInput===undefined)_.fileInput=this.element.is("input[type=\"file\"]")?this.element:this.element.find("input[type=\"file\"]");else if(!(_.fileInput instanceof $))_.fileInput=$(_.fileInput);if(!(_.dropZone instanceof $))_.dropZone=$(_.dropZone);if(!(_.pasteZone instanceof $))_.pasteZone=$(_.pasteZone)},_getRegExp:function($){var _=$.split("/"),A=_.pop();_.shift();return new RegExp(_.join("/"),A)},_isRegExpOption:function(A,_){return A!=="url"&&$.type(_)==="string"&&/^\/.*\/[igm]{0,3}$/.test(_)},_initDataAttributes:function(){var _=this,A=this.options;$.each($(this.element[0].cloneNode(false)).data(),function(B,$){if(_._isRegExpOption(B,$))$=_._getRegExp($);A[B]=$})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(A){var _=this;if(!A||this.options.disabled)return;if(A.fileInput&&!A.files)this._getFileInputFiles(A.fileInput).always(function($){A.files=$;_._onAdd(null,A)});else{A.files=$.makeArray(A.files);this._onAdd(null,A)}},send:function(D){if(D&&!this.options.disabled){if(D.fileInput&&!D.files){var A=this,_=$.Deferred(),E=_.promise(),B,C;E.abort=function(){C=true;if(B)return B.abort();_.reject(null,"abort","abort");return E};this._getFileInputFiles(D.fileInput).always(function($){if(C)return;if(!$.length){_.reject();return}D.files=$;B=A._onSend(null,D).then(function(A,$,B){_.resolve(A,$,B)},function(A,$,B){_.reject(A,$,B)})});return this._enhancePromise(E)}D.files=$.makeArray(D.files);if(D.files.length)return this._onSend(null,D)}return this._getXHRPromise(false,D&&D.context)}})}))