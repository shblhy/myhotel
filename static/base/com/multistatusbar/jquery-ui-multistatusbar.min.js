;(function(B,A){B.widget("ui-marccarre.multistatusbar",{version:"1.1.0",options:{width:200,payload:{},urls:{},colors:[],showLegend:true,showValuesInLegend:false,showValuesInBar:true,refreshUrl:null,legendPosition:"left",legendMarginLeftFromPayload:"",refreshFrequencyInMillis:5000,enableRefresh:true,onClick:function(){},id:0},_create:function(){this._doCreate();if(this.options.refreshUrl!=null)this._setUpAutoRefresh()},_doCreate:function(){var _=$(this.options.payload);if(_==0)this._createEmptyWidget();else this._createAndPopulateWidget(_)},_createEmptyWidget:function(){var $=new C(this.options.width);$.addValue("N/A",this.options.width,"#DDDDDD");this.element.append($.table)},_createAndPopulateWidget:function(F){var $=this.options.width/F,O=new C(this.options.width);this.element.append(O.table);if(this.options.showLegend){var L=new _();this.element.append(L.div);O.table.mouseover(function($){L.div.show()});O.table.mouseleave(function($){L.div.hide()})}var D=this.options.colors,G=this.options.payload,E=this.options.urls,J=0;for(var P in G){var M=G[P],K=D[J];if(M>0){var H=O.addValue((this.options.showValuesInBar?M:"&nbsp;"),M*$,K);if(P in E)H.wrapInner("<a href=\""+E[P]+"\" target=\"_blank\" ></a>")}if(this.options.showLegend)L.addCategory((this.options.showValuesInLegend?(P+": "+M+"/"+F):P),K);J++}if(this.options.onClick&&(typeof this.options.onClick=="function")){var N=this;this.element.click(function(){N.options.onClick.call(this,N.options.id)})}var I="multistatusbar";if(I in E)O.table.wrap("<a href=\""+E[I]+"\" target=\"_blank\" ></a>");if(this.options.showLegend){if(this.options.legendPosition=="right")L.div.css("margin-left",this.options.width-parseInt(L.div.css("width")));if(this.options.legendMarginLeftFromPayload){var B=this.options.legendMarginLeftFromPayload.split(","),A=0;for(P in B)if(B[P])A+=G[B[P]]*$;L.div.css("margin-left",A)}}},_setUpAutoRefresh:function(){function $(A){var E=A.options.refreshUrl;function _(_){var $=document.domain.toString();return($.length>0)&&(_.length>0)&&(_.indexOf($)!==-1)}function C(_){var $=window.location.hostname.toString();return($.length>0)&&(_.length>0)&&(_.indexOf($)!==-1)}function D(){return _(E)||C(E)||(E==="http://host:port/webservice/status")}if(A.options.enableRefresh)B.ajax({url:E,dataType:D()?"json":"jsonp"}).done(function($){A.options.payload=D()?$:JSON.parse($)}).fail(function(_,$,B){console.log("error: "+JSON.stringify(_)+"\n  status: "+$+"\n  error: "+B);A.options.payload={}}).always(function(){A.element.children().remove();A._doCreate();setTimeout(function(){$(A)},A.options.refreshFrequencyInMillis)})}$(this)},_setOption:function(_,$){this.options[_]=$;this.element.children().remove();this._doCreate()},_destroy:function(){this.options.enableRefresh=false;this.element.children().remove()}});function C($){this.table=B("<table width='"+$+"px' cellpadding='0' cellspacing='0'></table>");this.table.addClass("ui-widget").addClass("ui-state-default").addClass("ui-corner-all").addClass("ui-multistatusbar");this.tr=B("<tr></tr>");this.table.append(this.tr);this.addValue=function(A,_,$){var C=B("<td style='background-color: "+$+"; width:"+_+"px;'>"+A+"</td>");this.tr.append(C);return C}}function _(){this.div=B("<div></div>");this.div.addClass("ui-widget").addClass("ui-state-default").addClass("ui-corner-all").addClass("ui-multistatusbar-legend");this.table=B("<table></table>");this.div.append(this.table);this.div.hide();this.addCategory=function($,_){if(!_||(_=="transparent"))return;this.table.append("<tr><td><div class='ui-multistatusbar-legend-icon' style='background-color: "+_+";'></div></td><td>"+$+"</td></tr>")}}function $($){var _=0;for(var A in $)_+=$[A];return _}})(jQuery)